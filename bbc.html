<head>
<style type="text/css">
body {
  color:#333;
  min-width:350px;
  font-family:Helvetica, Arial;
  font-size:12px;
  overflow-x:hidden;
}

a {
  color:#06C;
  font-weight:bold;
  text-decoration:none;
}

a:hover {
  color:blue;
  text-decoration:underline;
}

h1 {
  font-size:18px;
  padding:0;
  margin-bottom:5px;
}

#content {
  line-height:16px;
}
</style>
<script type="text/javascript" src="js/jquery-1.4.1.min.js"></script>
<script>
function main() {
  var has_options = localStorage["bbc_stations"];

  if (has_options) {
    var req = new XMLHttpRequest();
    req.open(
        "GET",
        "http://www.bbc.co.uk/programmes/services.xml",
        true);
    req.onload = showNowNext;
    req.send(null);
  } else {
    var txt = document.getElementById("content");
    txt.innerHTML = "Welcome. To get started, you need to select some stations to display. Go to the <a href=\"#\" onclick=\"chrome.tabs.create({url: 'chrome://extensions'});\">Extensions page</a> and click the <strong>Options</strong> button for this extension.";
  }
}

function showNowNext() {
  var services = req.responseXML.getElementsByTagName("service");

  for (var i = 0, service; service = services[i]; i++) {
    var s = document.createElement("li");
    s.innerText = constructdata(service);
    document.body.appendChild(s);
  }
}

function constructdata(service) {
  return service.getAttribute("key");
}
</script>
</head>
<body onload="javascript:main()">
  <h1>BBC Now and Next information</h1>
  <div id="content">Loading...</div>
</body>
</html>
